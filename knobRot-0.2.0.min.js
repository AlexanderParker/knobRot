(function(a){var b={init:function(c){var d=a.extend({classes:["rot-knob"],frameCount:64,frameWidth:64,frameHeight:64,minimumValue:-100,maximumValue:100,detent:true,detentValue:0,detentThreshold:10,discreteSteps:false,stepCount:2,dragVertical:true,invertDirection:false,dragMultiplier:1,animationFPS:25,hideInput:false,hideRealValue:true,isToggle:true},c);a("body").data("knobRot",{dragging:false});b.addCssStyles();return this.each(function(){if(d.minimumValue>=d.maximumValue){}else if(d.discreteSteps==true&&d.stepCount<=1){throw"Knob range error: Maximum value must be greater than minimum value.";throw"Invalid step count: Discrete knob must have a minimum of 2 steps."}var c=a(this);c.attr("autocomplete","off");if(c.is("input:text")){var e=a("<input>",{type:"text",value:parseFloat(c.val()),autocomplete:"off"});e.data("knobRot",{settings:d,outputField:c});c.after(e);e.data("knobRot").rangeSize=d.maximumValue-d.minimumValue;e.data("knobRot").rangeOffset=0-d.minimumValue;if(d.discreteSteps==true){e.data("knobRot").stepIncrement=(d.maximumValue-d.minimumValue)/(d.stepCount-1)}e.data("knobRot").calculatedValue=b.calculateValue(e);e.data("knobRot").currentFrame=b.calculateFrame(e);e.data("knobRot").dirtyData=true;var f=1e3/d.animationFPS;var g=d.classes.slice();g[g.length]="rot-knob-base";var h=c.attr("name");if(typeof h=="undefined"){h="unnamed"}var i=c.attr("id");if(typeof i=="undefined"){i="noid"}g[g.length]="for-input-"+h+"-"+i;var j=a("<div>",{"class":g.join(" ")});j.data("knobRot",{realValue:e,outputField:c});e.data("knobRot").knobDiv=j;c.data("knobRot",{knob:j,realValue:e});j.css({width:d.frameWidth+"px",height:d.frameHeight+"px","background-position":b.calculateBackgroundOffsetX(e)+"px 0px",cursor:b.getDragCursorClass(e)});j.on("mousedown.knobRot",function(c){if(c.which!=1){return}$knobDiv=a(this);if(a("body").data("knobRot").dragging!=true){var d={left:c.screenX,top:c.screenY};$knobDiv.addClass("dragging");a("body").data("knobRot").dragging=true;a("body").data("knobRot").lastOffset=d;a("body").data("knobRot").knobDiv=$knobDiv;a("body").addClass(b.getDragCursorClass($knobDiv.data("knobRot").realValue));$knobDiv.data("knobRot").outputField.trigger("knobdragstart",$knobDiv)}});a(document).on("mousemove.knobRot",function(c){if(a("body").data("knobRot").dragging==true){var d={horizontal:c.screenX-a("body").data("knobRot").lastOffset.left,vertical:c.screenY-a("body").data("knobRot").lastOffset.top};a("body").data("knobRot").lastOffset={left:c.screenX,top:c.screenY};b.updateValue(a("body").data("knobRot").knobDiv.data("knobRot").realValue,d);a("body").data("knobRot").knobDiv.data("knobRot").outputField.trigger("knobrefresh",a("body").data("knobRot").knobDiv);a("body").data("knobRot").knobDiv.data("knobRot").outputField.trigger("knobdrag",a("body").data("knobRot").knobDiv)}});a(document).on("mouseup.knobRot",function(){b.stopDrag()});a("body").on("selectstart.knobRot select.knobRot mousedown.knobRot mouseover.knobRot",function(){if(a("body").data("knobRot").dragging==true){return false}});c.on("knobrefresh.knobRot",function(){e.data("knobRot").dirtyData=true});j.on("mouseover.knobRot mouseout.knobRot mouseup.knobRot",function(){j.data("knobRot").outputField.trigger("knobrefresh",j)});j.on("mouseover",function(){c.addClass("hover");var a=b.getDragCursorClass(j.data("knobRot").realValue);j.addClass(a);j.data("knobRot").outputField.trigger("knobmouseover",j)});j.on("mouseout",function(){c.removeClass("hover");var a=b.getDragCursorClass(j.data("knobRot").realValue);j.removeClass(a);j.data("knobRot").outputField.trigger("knobmouseout",j)});e.after(j);setInterval(function(){b.updateCallback(e)},f);if(d.hideInput==true){c.hide()}if(d.hideRealValue==true){e.hide()}c.attr("disabled","disabled");c.attr("unselectable","on");c.on("mousedown",function(){return false});c.on("mouseover",function(){return false});c.trigger("knobready",j)}})},getvalue:function(){$this=a(this);if($this.is("input:text")){if($this.data("knobRot")){return $this.data("knobRot").calculatedValue}else{throw'Can not call "value" on a non-knobRot element'}}else{throw"Not a valid input element for knobRot.getvalue"}},set:function(b){return a(this).each(function(){var c=a(this);if(c.is("input:text")){c.data("knobRot").realValue.val(parseFloat(b));c.data("knobRot").realValue.trigger("knobrefresh")}})},calculateStep:function(a){var b=a.data("knobRot");var c=b.settings;if(c.discreteSteps){var d=parseFloat(a.val())+b.rangeOffset;var e=d/b.rangeSize;var f=Math.round(e*(c.stepCount-1));return f}else{throw"Unable to calculate discrete step offset for non-discrete knob."}},calculateValue:function(a){var c=a.data("knobRot");var d=c.settings;if(d.discreteSteps==true){var e=b.calculateStep(a);var f=e*c.stepIncrement-c.rangeOffset}else{var f=parseFloat(a.val())}if(d.detent==true&&f>=d.detentValue-d.detentThreshold&&f<=d.detentValue+d.detentThreshold){if(a.data("knobRot").calculatedValue!=f&&(a.data("knobRot").calculatedValue<d.detentValue-d.detentThreshold||a.data("knobRot").calculatedValue>d.detentValue+d.detentThreshold)){a.data("knobRot").outputField.trigger("knobenterdetent",a.data("knobRot").knobDiv)}f=d.detentValue}else if(a.data("knobRot").calculatedValue==d.detentValue&&a.data("knobRot").calculatedValue!=f&&f!=d.detentValue){a.data("knobRot").outputField.trigger("knobleavedetent",a.data("knobRot").knobDiv)}if(f<d.minimumValue){a.val(d.minimumValue);a.data("knobRot").outputField.trigger("knobvaluemin",a.data("knobRot").knobDiv);return d.minimumValue}else if(f>d.maximumValue){a.val(d.maximumValue);a.data("knobRot").outputField.trigger("knobvaluemax",a.data("knobRot").knobDiv);return d.maximumValue}return f},calculateFrame:function(a){var c=a.data("knobRot");var d=c.settings;var e=b.calculateValue(a)+c.rangeOffset;var f=e/c.rangeSize;var g=Math.round(f*(d.frameCount-1));if(g>d.frameCount-1){return d.frameCount-1}else if(g<0){return 0}if(a.data("knobRot").currentFrame!=g){a.data("knobRot").outputField.trigger("knobframechange",[c,a.data("knobRot").currentFrame,g])}return g},calculateBackgroundOffsetX:function(a){var c=a.data("knobRot");var d=c.settings;return 0-b.calculateFrame(a)*d.frameWidth},updateCallback:function(a){if(a.data("knobRot").dirtyData==true){a.data("knobRot").dirtyData=false;a.data("knobRot").knobDiv.css("background-position",b.calculateBackrgroundOffset(a));a.data("knobRot").calculatedValue=b.calculateValue(a);a.data("knobRot").outputField.val(a.data("knobRot").calculatedValue)}},stopDrag:function(){if(a("body").data("knobRot").dragging==true){var c=a("body").data("knobRot").knobDiv;a("body").data("knobRot").dragging=false;c.removeClass("dragging");a("body").removeClass(b.getDragCursorClass(c.data("knobRot").realValue));c.data("knobRot").outputField.trigger("knobrefresh")}},updateValue:function(a,b){var c=0;if(a.data("knobRot").settings.dragVertical){c=b.vertical}else{c=b.horizontal}c=c*a.data("knobRot").settings.dragMultiplier;if(!a.data("knobRot").settings.invertDirection&&a.data("knobRot").settings.dragVertical==true||a.data("knobRot").settings.invertDirection&&a.data("knobRot").settings.dragVertical==false){c=0-c}var d=parseFloat(a.val());var e=d+c;if(e>a.data("knobRot").settings.maximumValue){e=a.data("knobRot").settings.maximumValue}else if(e<a.data("knobRot").settings.minimumValue){e=a.data("knobRot").settings.minimumValue}a.val(e)},calculateBackrgroundOffset:function(c){var d=b.calculateBackgroundOffsetX(c)+"px";var e="0px";if(c.data("knobRot").outputField.hasClass("hover")&&a("body").data("knobRot").dragging==false){e=0-c.data("knobRot").settings.frameHeight+"px"}if(a("body").data("knobRot").dragging==true&&c.is(a("body").data("knobRot").knobDiv.data("knobRot").realValue)){e=0-c.data("knobRot").settings.frameHeight*2+"px"}return d+" "+e},getDragCursorClass:function(a){if(a.data("knobRot").settings.dragVertical==true){return"rotknob-n-resize"}else{return"rotknob-e-resize"}},addCssStyles:function(){var b=a('<style type="text/css" rel="stylesheet">'+"\t.rotknob-n-resize{ cursor: n-resize!important; }"+"\t.rotknob-e-resize{ cursor: e-resize!important; }"+"</style>").appendTo("body")}};a.fn.knobRot=function(c){if(b[c]){return b[c].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof c==="object"||!c){return b.init.apply(this,arguments)}else{a.error("Method "+c+" does not exist on jQuery.knobRot")}}})(jQuery)